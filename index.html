<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Voice Interview Simulator ‚Äî Mechanical</title>
<style>
  :root{font-family:Inter,system-ui,Segoe UI,Roboto,Arial;--bg:#f7fafc;--card:#fff;--accent:#2563eb}
  body{margin:16px;background:var(--bg);color:#0f172a}
  .wrap{max-width:820px;margin:0 auto}
  .card{background:var(--card);border-radius:12px;padding:18px;margin-bottom:12px;box-shadow:0 6px 18px rgba(2,6,23,0.06)}
  h1{margin:0 0 8px;font-size:20px}
  select,button,input,textarea{font-size:14px;padding:8px;border-radius:8px;border:1px solid #e6edf3}
  .controls{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
  .big{padding:10px 14px;font-weight:600;background:var(--accent);color:white;border:none}
  .secondary{background:#eef2ff;color:#1e293b;border:1px solid #dbeafe}
  .info{font-size:13px;color:#334155;margin-top:6px}
  .question{font-weight:700;margin-top:12px}
  textarea{width:100%;min-height:84px;margin-top:8px}
  .feedback{Padding:10px;border-radius:8px;margin-top:8px;background:#f1f5f9}
  .score{font-size:18px;font-weight:700;color:#0b6b3a}
  .small{font-size:13px;color:#475569}
  .row{display:flex;gap:8px;align-items:center}
</style>
</head>
<body>
<div class="wrap">
  <div class="card">
    <h1>Voice Interview Simulator ‚Äî Mechanical (3 companies)</h1>
    <div class="small">Choose a company and press <strong>Start Interview</strong>. Use <strong>Record Answer</strong> to speak. Works offline in browser (no API keys).</div>

    <div style="margin-top:12px" class="row">
      <select id="companySelect">
        <option value="Tata">Tata Motors (Automobile)</option>
        <option value="Bosch">Bosch (Automation)</option>
        <option value="Kirloskar">Kirloskar (Pumps & Fluid)</option>
      </select>
      <button id="startBtn" class="big">Start Interview</button>
      <button id="restartBtn" class="secondary">Reset</button>
    </div>

    <div id="qaArea" style="display:none;margin-top:12px">
      <div class="question" id="questionText">Question will appear here...</div>
      <div class="controls">
        <button id="speakBtn" class="secondary">üîä Speak Question</button>
        <button id="recBtn" class="big">üéôÔ∏è Record Answer</button>
        <button id="stopRecBtn" class="secondary">‚èπ Stop</button>
        <button id="evalBtn" class="secondary">‚úÖ Evaluate (manual)</button>
      </div>

      <div class="info">Transcript (editable):</div>
      <textarea id="transcript" placeholder="Transcript from mic will appear here ‚Äî or type your answer and click Evaluate."></textarea>

      <div id="feedback" class="feedback small" style="display:none"></div>
      <div style="margin-top:12px" id="progress" class="small"></div>
    </div>

    <div id="resultArea" style="display:none" class="card">
      <div class="score" id="finalScore">Score: 0 / 0</div>
      <div id="finalFeedback" class="small"></div>
      <div style="margin-top:8px">
        <button id="tryAgain" class="big">Practice Another Company</button>
      </div>
    </div>
  </div>
</div>

<script>
/* ---------------------------
  Simple client-side Interview App
   - Uses SpeechSynthesis for TTS
   - Uses WebkitSpeechRecognition for STT (Chrome)
   - Keyword-based scoring
----------------------------*/
const companies = {
  "Tata":[
    {q:"Tell me about yourself and why you want to join Tata Motors?", keys:["motivation","automotive","team","design"], max:2},
    {q:"Explain the working principle of a 4-stroke SI engine.", keys:["intake","compression","power","exhaust"], max:3},
    {q:"What is the function of a differential in automobiles?", keys:["torque","wheels","speed","corner"], max:2},
    {q:"How do you select material for a car chassis? What factors are important?", keys:["strength","weight","fatigue","cost","stiffness"], max:3},
    {q:"Where do you see yourself in 5 years working with Tata Motors?", keys:["goals","learning","leadership","projects"], max:2}
  ],
  "Bosch":[
    {q:"Introduce yourself and share one strength that makes you fit for Bosch.", keys:["automation","mechatronics","problem","solver","problem-solving"], max:2},
    {q:"Explain the concept of mechatronics and its applications in manufacturing.", keys:["sensors","actuators","control","plc"], max:3},
    {q:"What are PLCs, and why are they important in automation?", keys:["ladder","logic","control","reliability","i/o"], max:3},
    {q:"What are the differences between hydraulic and pneumatic systems?", keys:["fluid","compressibility","force","speed","hydraulic","pneumatic"], max:3},
    {q:"Why do you prefer Bosch over other automation companies?", keys:["innovation","quality","fit","projects","culture"], max:2}
  ],
  "Kirloskar":[
    {q:"Give a short introduction and why you want to join Kirloskar.", keys:["pumps","fluid","manufacturing","motivation"], max:2},
    {q:"Explain the working principle of a centrifugal pump.", keys:["impeller","centrifugal","pressure","volute","flow"], max:3},
    {q:"What is cavitation? How can it be prevented in pumps?", keys:["vapor","bubbles","npsh","impeller","design"], max:3},
    {q:"What are the differences between IC engines and gas turbines?", keys:["combustion","moving parts","efficiency","rpm","turbine","engine"], max:3},
    {q:"If selected, how would you contribute to the company‚Äôs growth?", keys:["projects","learning","efficiency","teamwork","improve"], max:2}
  ]
};

let company = null, qIndex = 0, score = 0, totalMax = 0;
const companySelect = document.getElementById('companySelect');
const startBtn = document.getElementById('startBtn');
const restartBtn = document.getElementById('restartBtn');
const qaArea = document.getElementById('qaArea');
const questionText = document.getElementById('questionText');
const recBtn = document.getElementById('recBtn');
const stopRecBtn = document.getElementById('stopRecBtn');
const speakBtn = document.getElementById('speakBtn');
const transcriptEl = document.getElementById('transcript');
const feedbackEl = document.getElementById('feedback');
const evalBtn = document.getElementById('evalBtn');
const progressEl = document.getElementById('progress');
const resultArea = document.getElementById('resultArea');
const finalScoreEl = document.getElementById('finalScore');
const finalFeedbackEl = document.getElementById('finalFeedback');
const tryAgain = document.getElementById('tryAgain');

function speak(text){
  if(!("speechSynthesis" in window)) return alert("TTS not supported in this browser.");
  const u = new SpeechSynthesisUtterance(text);
  u.lang = 'en-US';
  speechSynthesis.cancel();
  speechSynthesis.speak(u);
}

// STT: WebKitSpeechRecognition (Chrome)
let recog = null, recognizing = false;
if(('webkitSpeechRecognition' in window) || ('SpeechRecognition' in window)){
  const SR = window.SpeechRecognition || window.webkitSpeechRecognition;
  recog = new SR();
  recog.lang = 'en-IN';
  recog.interimResults = false;
  recog.maxAlternatives = 1;
  recog.onstart = ()=>{recognizing = true; recBtn.textContent = "Recording..."; recBtn.disabled = true; stopRecBtn.disabled = false;}
  recog.onend = ()=>{recognizing = false; recBtn.disabled = false; recBtn.textContent = "üéôÔ∏è Record Answer"; stopRecBtn.disabled = true;}
  recog.onerror = (e)=>{console.log('STT error',e); recognizing=false; recBtn.disabled=false; stopRecBtn.disabled=true}
  recog.onresult = (ev)=>{ const text = ev.results[0][0].transcript; transcriptEl.value = text; }
}

startBtn.onclick = ()=>{
  company = companySelect.value;
  qIndex = 0; score = 0; totalMax = 0;
  qaArea.style.display = 'block';
  resultArea.style.display = 'none';
  feedbackEl.style.display = 'none';
  transcriptEl.value = '';
  loadQuestion();
};

restartBtn.onclick = resetAll;
tryAgain.onclick = resetAll;

function resetAll(){
  qaArea.style.display = 'none';
  resultArea.style.display = 'none';
  company=null; qIndex=0; score=0; totalMax=0;
  transcriptEl.value='';
  feedbackEl.style.display='none';
  speechSynthesis.cancel();
}

function loadQuestion(){
  const arr = companies[company];
  if(qIndex >= arr.length){
    finishInterview(); return;
  }
  const item = arr[qIndex];
  questionText.textContent = `Q${qIndex+1}. ${item.q}`;
  progressEl.textContent = `Question ${qIndex+1} of ${arr.length} ‚Äî Current score: ${score}`;
  // speak question
  speak(item.q);
  // clear previous transcript & feedback
  transcriptEl.value = '';
  feedbackEl.style.display = 'none';
  // compute total max
  totalMax = arr.reduce((s,it)=>s+it.max,0);
}

recBtn.onclick = ()=>{
  if(!recog) return alert("Speech Recognition not supported in this browser. Use Chrome or type your answer and press Evaluate.");
  transcriptEl.value = '';
  try{recog.start();}catch(e){console.warn(e); }
};

stopRecBtn.onclick = ()=>{
  if(recog && recognizing){ recog.stop(); }
};

// Manual evaluate button
evalBtn.onclick = () => evaluateAnswer(transcriptEl.value.trim());

speakBtn.onclick = ()=> speak(questionText.textContent.replace(/^Q\d+\.\s*/,''));

function evaluateAnswer(text){
  if(!text) return alert("Please record or type your answer first.");
  const arr = companies[company];
  const item = arr[qIndex];
  const ans = text.toLowerCase();
  let qscore = 0;
  // For each keyword, add fractional points; cap at item.max
  const keys = item.keys;
  let matched = 0;
  for(const k of keys){
    // handle synonyms or multi-word keys: check each token in k split by |
    const parts = k.split('|').map(p=>p.trim());
    for(const p of parts){
      if(p && ans.includes(p)) { matched++; break; }
    }
  }
  // score proportional to matched / keys.length * max
  qscore = Math.round((matched / keys.length) * item.max);
  // small bonus if answer length is long (encourages detail) ‚Äî optional
  if(ans.split(/\s+/).length > 25 && qscore < item.max) qscore = Math.min(item.max, qscore+1);

  score += qscore;
  // feedback generation
  const missing = keys.filter(k=>{
    const parts = k.split('|').map(p=>p.trim());
    return !parts.some(p=>ans.includes(p));
  });
  let fb = `You scored ${qscore}/${item.max} on this question.`;
  if(missing.length===0) fb += " Good ‚Äî you covered all key points.";
  else fb += ` Try to mention: ${missing.slice(0,4).join(', ')}.`;

  feedbackEl.style.display = 'block';
  feedbackEl.innerHTML = `<strong>Feedback:</strong> ${fb}`;
  progressEl.textContent = `Answered Q${qIndex+1}. Score now: ${score} / ${totalMax}`;
  // speak feedback
  speak(fb);

  // next question after a short delay
  qIndex++;
  setTimeout(()=> loadQuestion(), 1300);
}

function finishInterview(){
  qaArea.style.display = 'none';
  resultArea.style.display = 'block';
  finalScoreEl.textContent = `Score: ${score} / ${totalMax}`;
  let comment = '';
  const percent = (totalMax>0)? Math.round((score/totalMax)*100) : 0;
  if(percent>=80) comment = "Excellent performance ‚Äî strong answers!";
  else if(percent>=60) comment = "Good ‚Äî a little more detail and you'll be ready.";
  else if(percent>=40) comment = "Fair ‚Äî practice improving technical depth.";
  else comment = "Practice more: try to cover keywords and give structured answers.";

  finalFeedbackEl.textContent = `${comment} (${percent}%) ‚Äî Review the feedback for each question while practicing.`;
  speak(`Interview finished. Your score is ${score} out of ${totalMax}. ${comment}`);
}

/* quick hotkeys for convenience */
document.addEventListener('keydown',(e)=>{
  if(e.key==='r' && qaArea.style.display!=='none') recBtn.click();
  if(e.key==='s') stopRecBtn.click();
});
</script>
</body>
</html>
